<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="static/motpal.js"></script>
    <script type="text/javascript">
        function connect_stream(timeout = 250) {
            console.log("Connecting to stream...");
            var source = new EventSource("/stream");
            source.addEventListener("player_update", function (event) {
                update_player_list(JSON.parse(event.data));
            }, false);
            source.addEventListener("error", async function (event) {
                console.log("Connection lost. Trying again in " + timeout + " ms.");
                await new Promise(r => setTimeout(r, timeout));
                connect_stream(timeout);
            }, false);
        }

        window.onload = function () {
            load_players();
            connect_stream();
        };
    </script>
</head>

<body>
    <iframe name="iframe" style="display: none;"></iframe>
    <h1>Most of these people are lying</h1>
    <h2>Your entry:</h2>
    <form action="add" method="POST" target="iframe">
        <input type="text" id="name-text" name="name" />
        <input type="text" id="article-text" name="article" />
        <input type="submit" value="Enter" />
    </form>
    <h2>Active Players:</h2>
    <ul id="player_list"></ul>
</body>

</html>